function OVV(){function t(e){var t=function(){var t={ID:0,name:"",version:""};var r=e;for(var i=0;i<n.length;i++){if(r.match(new RegExp(n[i].brRegex))!=null){t.ID=n[i].id;t.name=n[i].name;if(n[i].verRegex==null){break}var s=r.match(new RegExp(n[i].verRegex+"[0-9]*"));if(s!=null){var o=s[0].match(new RegExp(n[i].verRegex));t.version=s[0].replace(o[0],"")}break}}return t};var n=[{id:4,name:"Opera",brRegex:"OPR|Opera",verRegex:"(OPR/|Version/)"},{id:1,name:"MSIE",brRegex:"MSIE|Trident/7.*rv:11|rv:11.*Trident/7",verRegex:"(MSIE |rv:)"},{id:2,name:"Firefox",brRegex:"Firefox",verRegex:"Firefox/"},{id:3,name:"Chrome",brRegex:"Chrome",verRegex:"Chrome/"},{id:5,name:"Safari",brRegex:"Safari|(OS |OS X )[0-9].*AppleWebKit",verRegex:"Version/"}];return t()}this.DEBUG=false;this.IN_IFRAME=window.top!==window.self;this.asset=null;this.positionInterval=null;var e=window.testOvvConfig&&window.testOvvConfig.userAgent?window.testOvvConfig.userAgent:navigator.userAgent;this.browserIDEnum={MSIE:1,Firefox:2,Chrome:3,Opera:4,safari:5};this.browser=t(e);this.interval=Number("INTERVAL");this.version="VERSION";var n={};var r=[];var i=1e3;var s=[];this.addAsset=function(e){if(!n.hasOwnProperty(e.getId())){n[e.getId()]=e;this.asset=e}};this.removeAsset=function(e){delete n[e.getId()]};this.getAssetById=function(e){return n[e]};this.getAds=function(){var e={};for(var t in n){if(n.hasOwnProperty(t)){e[t]=n[t]}}return e};this.subscribe=function(e,t,n,i){if(i){for(key in r[t]){if(u(r[t][key].eventName,e)){a(function(){n(t,r[t][key])})}}}for(key in e){if(!s[e[key]+t])s[e[key]+t]=[];s[e[key]+t].push({Func:n})}};this.publish=function(e,t,n){var u={eventName:e,eventTime:o(),ovvArgs:n};if(!r[t]){r[t]=[]}if(r[t].length<i){r[t].push(u)}if(e&&t&&s[e+t]instanceof Array){for(var f=0;f<s[e+t].length;f++){var l=s[e+t][f];if(l&&l.Func&&typeof l.Func==="function"){a(function(){l.Func(t,u)})}}}};var o=function(){"use strict";if(Date.now){return Date.now()}return(new Date).getTime()};var u=function(e,t){for(var n=0;n<t.length;n++){if(t[n]===e){return true}}return false};var a=function(e){try{var t=e();return t!==undefined?t:true}catch(n){return false}}}function OVVCheck(){this.clientHeight=-1;this.clientWidth=-1;this.error="";this.focus=null;this.fps=-1;this.id="";this.beaconsSupported=null;this.geometrySupported=null;this.geometryViewabilityState="";this.beaconViewabilityState="";this.technique="";this.beacons=new Array;this.inIframe=null;this.objBottom=-1;this.objLeft=-1;this.objRight=-1;this.objTop=-1;this.percentViewable=-1;this.viewabilityState=""}function OVVAsset(e){var t=13;var n=Math.sqrt(2);var r=0;var i=1;var s=2;var o=3;var u=4;var a=5;var f=6;var l=7;var c=8;var h=9;var p=10;var d=11;var v=12;var m=13;var g=e;var y=0;var b=$ovv.DEBUG?20:1;var w;var E;var S=null;this.checkViewability=function(){var e=new OVVCheck;e.id=g;e.inIframe=$ovv.IN_IFRAME;e.geometrySupported=!$ovv.IN_IFRAME;e.focus=_();if(!E){e.error="Player not found!";return e}if(($ovv.browser.ID===$ovv.browserIDEnum.MSIE||$ovv.browser.ID===$ovv.browserIDEnum.Firefox)&&$ovv.IN_IFRAME){e.viewabilityState=OVVCheck.UNMEASURABLE;if(!$ovv.DEBUG){return e}}if(e.geometrySupported){e.technique=OVVCheck.GEOMETRY;x.bind(this)(e,E);e.viewabilityState=e.percentViewable>=50?OVVCheck.VIEWABLE:OVVCheck.UNVIEWABLE;if($ovv.DEBUG){e.geometryViewabilityState=e.viewabilityState}else{return e}}var t=A(0);if(t&&t.isViewable){var n=L(t)&&t.isViewable();e.beaconsSupported=!n}else{e.beaconsSupported=false}if(!N()){e.technique=OVVCheck.BEACON;e.viewabilityState=OVVCheck.NOT_READY}else if(e.beaconsSupported){e.technique=OVVCheck.BEACON;var r=T.bind(this)(e);if(r===null){e.viewabilityState=OVVCheck.UNMEASURABLE;if($ovv.DEBUG){e.beaconViewabilityState=OVVCheck.UNMEASURABLE}}else{e.viewabilityState=r?OVVCheck.VIEWABLE:OVVCheck.UNVIEWABLE;if($ovv.DEBUG){e.beaconViewabilityState=r?OVVCheck.VIEWABLE:OVVCheck.UNVIEWABLE}}}else{e.viewabilityState=OVVCheck.UNMEASURABLE}if($ovv.DEBUG){e.technique="";if(e.geometryViewabilityState===null&&e.beaconViewabilityState===null){e.viewabilityState=OVVCheck.UNMEASURABLE}else{var i=e.beaconViewabilityState===OVVCheck.VIEWABLE;var s=e.geometryViewabilityState===OVVCheck.VIEWABLE;e.viewabilityState=i||s?OVVCheck.VIEWABLE:OVVCheck.UNVIEWABLE}}return e};this.beaconStarted=function(e){if($ovv.DEBUG){A(e).debug()}if(e===0){return}y++;if(N()){E.startImpressionTimer()}};this.dispose=function(){for(var e=1;e<=t;e++){var n=O(e);if(n){delete y[e];n.parentElement.removeChild(n)}}clearInterval(window.$ovv.positionInterval);window.$ovv.removeAsset(this)};this.getId=function(){return g};this.getPlayer=function(){return E};var x=function(e,t){e.clientWidth=Infinity;e.clientHeight=Infinity;if(!isNaN(document.body.clientWidth)&&document.body.clientWidth>0){e.clientWidth=document.body.clientWidth}if(!isNaN(document.body.clientHeight)&&document.body.clientHeight>0){e.clientHeight=document.body.clientHeight}if(!!document.documentElement&&!!document.documentElement.clientWidth&&!isNaN(document.documentElement.clientWidth)){e.clientWidth=document.documentElement.clientWidth}if(!!document.documentElement&&!!document.documentElement.clientHeight&&!isNaN(document.documentElement.clientHeight)){e.clientHeight=document.documentElement.clientHeight}if(!!window.innerWidth&&!isNaN(window.innerWidth)){e.clientWidth=Math.min(e.clientWidth,window.innerWidth)}if(!!window.innerHeight&&!isNaN(window.innerHeight)){e.clientHeight=Math.min(e.clientHeight,window.innerHeight)}if(e.clientHeight==Infinity||e.clientWidth==Infinity){e={error:"Failed to determine viewport"}}else{var n=t.getClientRects()[0];e.objTop=n.top;e.objBottom=n.bottom;e.objLeft=n.left;e.objRight=n.right;if(n.bottom<0||n.right<0||n.top>e.clientHeight||n.left>e.clientWidth){e.percentViewable=0}else{var r=(n.right-n.left)*(n.bottom-n.top);var i=Math.ceil(Math.max(0,n.left));var s=Math.floor(Math.min(e.clientWidth,n.right));var o=Math.ceil(Math.max(0,n.top));var u=Math.floor(Math.min(e.clientHeight,n.bottom));var a=(s-i+1)*(u-o+1);e.percentViewable=Math.floor(a/r*100)}}};var T=function(e){if(!N()){return null}var n=0;var r=0;var g=0;var y=0;e.beacons=new Array(t);var b=E.getClientRects()[0];e.objTop=b.top;e.objBottom=b.bottom;e.objLeft=b.left;e.objRight=b.right;for(var w=0;w<=t;w++){var S=A(w);var x=S.isViewable();var T=L(S);e.beacons[w]=x&&T;if(w===0){continue}if(x){n++;switch(w){case s:case o:case u:case a:r++;break;case f:case l:case c:case h:g++;break;case p:case d:case v:case m:y++;break}}}if(n===t){return true}var C=e.beacons;if(C[i]===true&&C[s]===true&&C[o]==true||C[s]===true&&C[u]==true||C[o]===true&&C[a]==true||C[u]===true&&C[a]==true){return true}if(C[i]===false&&y>=3){return true}if(C[i]===true&&g==4){return true}if(C[s]&&C[a]&&(!C[f]||![p]||!C[i]||C[m]||C[h])){return null}if(C[u]&&C[o]&&(!C[c]||!C[v]||!C[i]||!C[d]||!C[l])){return null}return false};var N=function(){if(!E){return false}return y===t};var C=function(e){if(e===""||e==="BEACON"+"_SWF_"+"URL"){return}for(var n=0;n<=t;n++){var r=document.createElement("DIV");r.id="OVVBeaconContainer_"+n+"_"+g;r.style.position="absolute";r.style.zIndex=$ovv.DEBUG?99999:-99999;var i='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+b+'" height="'+b+'">'+'<param name="movie" value="'+e+"?id="+g+"&index="+n+'" />'+'<param name="quality" value="low" />'+'<param name="bgcolor" value="#ffffff" />'+'<param name="wmode" value="transparent" />'+'<param name="allowScriptAccess" value="always" />'+'<param name="allowFullScreen" value="false" />'+"<!--[if !IE]>-->"+'<object id="OVVBeacon_'+n+"_"+g+'" type="application/x-shockwave-flash" data="'+e+"?id="+g+"&index="+n+'" width="'+b+'" height="'+b+'">'+'<param name="quality" value="low" />'+'<param name="bgcolor" value="#ff0000" />'+'<param name="wmode" value="transparent" />'+'<param name="allowScriptAccess" value="always" />'+'<param name="allowFullScreen" value="false" />'+"<!--<![endif]-->"+"</object>";r.innerHTML=i;document.body.insertBefore(r,document.body.firstChild)}k.bind(this)();this.positionInterval=setInterval(k.bind(this),500)};var k=function(){if(!N()){return}var e=E.getClientRects()[0];if(w&&w.left===e.left&&w.right===e.right&&w.top===e.top&&w.bottom===e.bottom){return}w=e;var g=e.right-e.left;var y=e.bottom-e.top;var S=g/(1+n);var x=y/(1+n);var T=g/n;var C=y/n;for(var k=0;k<=t;k++){var L=e.left+document.body.scrollLeft;var A=e.top+document.body.scrollTop;switch(k){case r:L=-1e5;A=-1e5;break;case i:L+=(g-b)/2;A+=(y-b)/2;break;case s:break;case o:L+=g-b;break;case u:A+=y-b;break;case a:L+=g-b;A+=y-b;break;case f:L+=(g-T)/2;A+=(y-C)/2;break;case l:L+=(g-T)/2+T;A+=(y-C)/2;break;case c:L+=(g-T)/2;A+=(y-C)/2+C;break;case h:L+=(g-T)/2+T;A+=(y-C)/2+C;break;case p:L+=(g-S)/2;A+=(y-x)/2;break;case d:L+=(g-S)/2+S;A+=(y-x)/2;break;case v:L+=(g-S)/2;A+=(y-x)/2+x;break;case m:L+=(g-S)/2+S;A+=(y-x)/2+x;break}if(k>=f){L-=b/2;A-=b/2}var M=O(k);M.style.left=L+"px";M.style.top=A+"px"}};var L=function(e){if(!e){return false}var t=Math.max(document.body.clientWidth,window.innerWidth);var n=Math.max(document.body.clientHeight,window.innerHeight);var r=e.getClientRects()[0];return r.top<n&&r.bottom>0&&r.left<t&&r.right>0};var A=function(e){return document.getElementById("OVVBeacon_"+e+"_"+g)};var O=function(e){return document.getElementById("OVVBeaconContainer_"+e+"_"+g)};var M=function(){var e=document.getElementsByTagName("embed");for(var t=0;t<e.length;t++){if(e[t][g]){return e[t]}}var n=document.getElementsByTagName("object");for(var t=0;t<n.length;t++){if(n[t][g]){return n[t]}}return null};var _=function(){var e=true;if(typeof document.hidden!=="undefined"){e=window.document.hidden?false:true}else if(document.hasFocus){e=document.hasFocus()}if($ovv.IN_IFRAME===false&&e===true&&document.hasFocus){e=document.hasFocus()}return e};E=M();if($ovv.IN_IFRAME||$ovv.DEBUG){C.bind(this)("BEACON_SWF_URL")}else{if(E&&E.startImpressionTimer)E.startImpressionTimer()}}OVVCheck.UNMEASURABLE="unmeasurable";OVVCheck.VIEWABLE="viewable";OVVCheck.UNVIEWABLE="unviewable";OVVCheck.NOT_READY="not_ready";OVVCheck.BEACON="beacon";OVVCheck.GEOMETRY="geometry";window.$ovv=window.$ovv||new OVV;window.$ovv.addAsset(new OVVAsset("OVVID"))
